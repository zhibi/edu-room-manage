<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.room.manage.mapper.MenuMapper">
    <delete id="deleteById">
        delete FROM menu where id = #{id};
        delete from role_menu where menu_id = #{id};
    </delete>

    <!-- 根据用用户ID查询权限code -->
    <select id="selectMenuCodeByUserId" resultType="java.lang.String">
        select m.code from menu m
        left join role_menu rm on m.menu_id = rm.menu_id
        left join  user_role ur on rm.role_id = ur.role_id
        left join role r on r.id = rm.role_id
        where ur.user_id =#{id}  and r.enable = 1 and m.menu_type &lt;&gt; 'BUTTON'
    </select>

    <!-- 根据所有权限code -->
    <select id="selectALLMenuCode" resultType="java.lang.String">
        select code from menu
    </select>


    <select id="selectMenuByUserId" resultType="edu.room.manage.domain.Menu">
        select m.* from menu m
        left join role_menu rm on m.id = rm.menu_id
        left join  user_role ur on rm.role_id = ur.role_id
        left join role r on r.id = rm.role_id
        where ur.user_id =#{id}  and r.enable = 1 and m.type &lt;&gt; 'BUTTON'
        order by m.sort asc
    </select>

    <select id="selectAllMenu" resultType="edu.room.manage.domain.Menu">
        select m.* from menu m
        where m.type &lt;&gt; 'button'
        order by m.sort asc
    </select>

    <select id="selectMenuByRoleId" resultType="edu.room.manage.domain.Menu">
        select m.* from role_menu rm
        left join menu m on rm.menu_id = m.id
        where rm.role_id=#{id}
    </select>


</mapper>